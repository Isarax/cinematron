!function(e){var t=0;e(document).on("click",".add_fields",function(n){n.preventDefault();var i=e(this),o=i.data("association"),r=i.data("associations"),s=i.data("association-insertion-template"),a=i.data("association-insertion-method")||i.data("association-insertion-position")||"before";insertionNode=i.data("association-insertion-node"),insertionTraversal=i.data("association-insertion-traversal"),regexp_braced=new RegExp("\\[new_"+o+"\\](.*?\\s)","g"),regexp_underscord=new RegExp("_new_"+o+"_(\\w*)","g"),new_id=(new Date).getTime()+t++,newcontent_braced="["+new_id+"]",newcontent_underscord="_"+new_id+"_",new_content=s.replace(regexp_braced,"["+new_id+"]$1"),new_content==s&&(regexp_braced=new RegExp("\\[new_"+r+"\\](.*?\\s)","g"),regexp_underscord=new RegExp("_new_"+r+"_(\\w*)","g"),new_content=s.replace(regexp_braced,"["+new_id+"]$1")),new_content=new_content.replace(regexp_underscord,newcontent_underscord+"$1"),insertionNode=insertionNode?insertionTraversal?i[insertionTraversal](insertionNode):"this"==insertionNode?i:e(insertionNode):i.parent();var l=e(new_content);insertionNode.trigger("cocoon:before-insert",[l]),insertionNode[a](l),insertionNode.trigger("cocoon:after-insert",[l])}),e(document).on("click",".remove_fields.dynamic, .remove_fields.existing",function(t){var n=e(this),i=n.closest(".nested-fields"),o=i.parent();t.preventDefault(),o.trigger("cocoon:before-remove",[i]);var r=o.data("remove-timeout")||0;setTimeout(function(){n.hasClass("dynamic")?n.closest(".nested-fields").remove():(n.prev("input[type=hidden]").val("1"),n.closest(".nested-fields").hide()),o.trigger("cocoon:after-remove",[i])},r)})}(jQuery);